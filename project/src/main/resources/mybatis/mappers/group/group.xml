<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="group">
	<resultMap id="result" type="java.util.HashMap">
	</resultMap>

	<insert id="insertGroup" parameterType="java.util.Map">
		<selectKey resultType="string" keyProperty="group_num"
			order="BEFORE">
			SELECT CASE WHEN MAX(GROUP_NUM)+1 IS NOT NULL THEN
			MAX(GROUP_NUM)+1
			ELSE 1
			end as group_num
			FROM group_table
		</selectKey>
		INSERT INTO group_table(group_num, group_name, group_leader,
		group_category, group_date, group_desc, group_joinmanner)
		VALUES
		(#{group_num} , #{group_name}, #{user_id}, #{group_category}, sysdate,
		#{group_desc}, #{manner})
	</insert>

	<insert id="insertMember">
		INSERT INTO join_group_list(group_num, user_id,
		g_list_state, g_list_candidate, g_list_joindate)
		VALUES(#{group_num},
		#{user_id}, #{g_list_state}, sysdate, sysdate)

	</insert>

	<select id="selectMaxGroupNum" resultMap="result"
		parameterType="java.util.Map">
		SELECT max(group_num) group_num
		FROM group_table
	</select>

	<select id="selectUserGroup" resultMap="result"
		parameterType="java.util.Map">
		<![CDATA[
			select *
			from group_table g, join_group_list l 
		]]>
		<where>
			<if test=" user_id != ''  and  user_id != null">
				user_id = #{user_id}
			</if>
		</where>
		order by category_name asc
	</select>

	<select id="selectWholeGroup" resultMap="result"
		parameterType="java.util.Map">
		SELECT
		GROUP_NUM,GROUP_NAME,GROUP_LEADER,GROUP_CATEGORY,GROUP_DATE,GROUP_DESC,
		(select count(user_id)
		from join_group_list l
		where l.group_num =
		t.group_num) MEMBER_COUNT
		from group_table t
	</select>

	<select id="selectOneGroup" resultMap="result"
		parameterType="java.util.Map">
		<![CDATA[
			select *
			from group_table 
		]]>
		<where>
			group_num = #{num}
		</where>
	</select>

	<select id="selectGroupMember" resultMap="result"
		parameterType="java.util.Map">
		<![CDATA[
		SELECT *
		FROM group_table g, join_group_list l 
		]]>
		<where>g.group_num = l.group_num and g.group_num = ${group_num}</where>
	</select>
	
	<select id="checkMemberState" resultMap="result" parameterType="java.util.Map">
		SELECT g_list_state state 
		FROM join_group_list 
		WHERE group_num = #{num} and user_id = #{user_id} 
	</select>
	
	<select id="selectGroupBoard" resultMap="result" parameterType="java.util.Map">
		SELECT board_name
		FROM board 
	</select>


</mapper>