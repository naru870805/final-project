<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="yoonju.H.H_P001.H_p001_d001DAO">
<resultMap id="articlesResult" type="articleVO">
<!--     <result property="level" column="level" /> -->
    <result property="post_num" column="post_num" />
    <result property="post_parent" column="post_parent" />
    <result property="post_title" column="post_title" />
    <result property="post_content" column="post_content" />
    <result property="post_date" column="post_date" />
    <result property="imageFileName" column="imageFileName" />
    <result property="board_num" column="board_num" /> 
  </resultMap> 
  
  <resultMap id="imgResult" type="imageVO">
	  <result property="imageFileNO" column="imageFileNO" />
	  <result property="post_num" column="post_num" />
	  <result property="imageFileName" column="imageFileName" />
 </resultMap>

  <select id="selectAllArticlesList" resultMap="articlesResult"   >		<!-- 글목록 보기 -->
    <![CDATA[
      SELECT post_num, post_parent, post_title, post_content, post_date, imageFileName, user_id, board_num
      FROM post
      ORDER BY post_date desc
    ]]>
  </select>
  
	<!--단일이미지 추가  -->
	 
  <insert id="insertNewArticle"  parameterType="java.util.Map">					<!-- SQL에 글추가 -->
		<![CDATA[
			INSERT into post(post_num, post_title, post_content, imageFileName, user_id, post_date, post_parent, board_num)
			VALUES(#{post_num},#{post_title}, #{post_content}, #{imageFileName}, #{user_id}, SYSDATE, 0, 0)
		]]>      
	</insert>
	
  <select id="selectNewArticleNO" resultType="String"  > 						<!-- 글번호 자동 부여 -->
		<![CDATA[
			SELECT max(TO_NUMBER(post_num)) +1
			FROM post
		]]>
	</select>
	
  <select id="selectArticle" resultType="articleVO"   parameterType="String"> 	<!-- 한 개 글정보 조회 -->
    <![CDATA[
      SELECT * from post
      where post_num = #{post_num}		
    ]]>
  </select>
  
  <update id="updateArticle"  parameterType="java.util.Map">
			update post
			set post_title=#{post_title},	 
				post_content=#{post_content}
			 <if test="imageFileName!='' and imageFileName!=null">
			  , imageFileName=#{imageFileName}
			</if>
			where post_num=#{post_num}
	</update>
	
	<delete id="deleteArticle"  parameterType="String"> <!-- 여기 인트를 스트링으로 바꿈 -->
    <![CDATA[
      delete from post
      where post_num in (
         SELECT post_num FROM  post
         START WITH post_num = #{post_num}
         CONNECT BY PRIOR  post_num = post_parent )
    ]]>      
  </delete>

 
  <select id="selectNewImageFileNO" resultType="String"  > <!-- 여기 인트를 스트링으로 바꿈 -->
    <![CDATA[
      SELECT  nvl(max(imageFileNO),0) from t_imageFile		
    ]]>
  </select>
	

  <select  id="selectImageFileList" resultMap="imgResult" parameterType="String"> <!-- 여기 인트를 스트링으로 바꿈 -->
    <![CDATA[
      SELECT * from t_imageFile
      where post_num=#{post_num}	
    ]]>
  </select> 
</mapper>